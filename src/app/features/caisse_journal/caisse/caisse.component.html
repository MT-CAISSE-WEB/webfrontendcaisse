<!-- start page title -->
<div class="row">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0">{{title}}</h4>
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="javascript: void(0);">Caisse & journal</a></li>
                    <li class="breadcrumb-item active">{{title}}</li>
                </ol>
            </div>
        </div>
    </div>
</div>
<!-- end page title -->

<div class="row">
    <div class="col-lg-12">
        <div class="card" id="orderList">
            <div class="card-header border-0">
                <div class="row align-items-center gy-3">
                    <div class="col-sm-auto">
                        <div class="d-flex gap-1 flex-wrap">
                            <button type="button" class="btn btn-sm btn-soft-success" data-bs-toggle="modal" (click)="modalCreate()" id="create-btn" data-bs-target="#showModal"><i class="ri-add-line align-bottom me-1"></i>créer</button>
                            <button type="button" class="btn btn-sm btn-soft-info"><i class="ri-file-download-line align-bottom me-1"></i> import</button>
                            <button class="btn btn-sm btn-soft-danger" [disabled]="!checkAllRow" onClick="deleteMultiple()"><i class="ri-delete-bin-2-line"></i></button>
                            <button type="button" class="btn btn-sm btn-info"> <i class="ri-refresh-fill align-bottom me-1"></i>actualiser</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body border border-dashed border-end-0 border-start-0">
                <form>
                    <div class="row g-3">
                        <div class="col-xxl-5 col-sm-6">
                            <div class="search-box">
                                <input type="text" class="form-control form-control-sm search" placeholder="rechercher par code, libelle...">
                                <i class="ri-search-line search-icon"></i>
                            </div>
                        </div>
                        <!--end col-->
    
                        <!--end col-->
                        <div class="col-xxl-2 col-sm-4">
                            <div>
                                <select class="form-control form-control-sm" data-choices data-choices-search-false name="choices-single-default" id="idStatus">
                                    <option value="">Status</option>
                                    <option value="all" selected>tous</option>
                                    <option value="Pending">Actif</option>
                                    <option value="Pending">Inactif</option>
                                </select>
                            </div>
                        </div>
                        <!--end col-->
                        
                        <!--end col-->
                        <div class="col-xxl-1 col-sm-2">
                            <div>
                                <button type="button" class="btn btn-sm btn-primary w-100"> <i class="ri-equalizer-fill me-1 align-bottom"></i>
                                    Filtrer
                                </button>
                            </div>
                        </div>
                        <!--end col-->
                    </div>
                    <!--end row-->
                </form>
            </div>
            <div class="card-body pt-0">
                <div>
                    <ul class="nav nav-tabs nav-tabs-custom nav-success mb-3" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active All py-3" data-bs-toggle="tab" id="All" href="#home1" role="tab" aria-selected="true">
                                <i class="ri-store-2-fill me-1 align-bottom"></i> Tous
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link py-3 Delivered" data-bs-toggle="tab" id="Delivered" href="#delivered" role="tab" aria-selected="false">
                                <i class="ri-checkbox-circle-line me-1 align-bottom"></i> Actif
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link py-3 Pickups" data-bs-toggle="tab" id="Pickups" href="#pickups" role="tab" aria-selected="false">
                                <i class="ri-truck-line me-1 align-bottom"></i> Inactif <span class="badge bg-danger align-middle ms-1">2</span>
                            </a>
                        </li>
                    </ul>

                    <div class="table-responsive table-card mb-1">
                        <table class="table table-nowrap align-middle" id="orderTable">
                            <thead class="text-muted table-light">
                                <tr class="text-uppercase">
                                    <th scope="col" style="width: 25px;">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" [(ngModel)]="checkAllRow" id="checkAll" (ngModelChange)="handleSelectAll($event)">
                                        </div>
                                    </th>
                                    <th class="sort" data-sort="id">Code</th>
                                    <th class="sort" data-sort="libelle">Libelle</th>
                                    <th class="sort" data-sort="devise">Devise</th>
                                    <th class="sort" data-sort="compte">Compte</th>
                                    <th class="sort" data-sort="journal">Journal</th>
                                    <th class="sort" data-sort="status">Status</th>
                                    <th class="sort" data-sort="city">Action</th>
                                </tr>
                            </thead>
                            <tbody class="list form-check-all">
                                @for (item of caisses; track $index){
                                    <tr>
                                    <th scope="row">
                                        <div class="form-check">
                                            <input class="form-check-input" [checked]="isChecked(item.idcaisse)" [(ngModel)]="selectedItems[$index]" (ngModelChange)="handleSelectOne(item, $event)" type="checkbox" name="itemGroup_{{ $index }}">
                                        </div>
                                    </th>
                                    <td class="code"><a href="#" class="fw-medium link-primary">{{item.codecaisse}}</a></td>
                                    <td class="customer_name">{{item.libelle}}</td>
                                    <td class="customer_name">{{item.devise.codedevise || ''}}</td>
                                    <td class="customer_name">{{item.compte.numcompte || ''}}</td>
                                    <td class="customer_name">{{item.journal.codejournal || ''}}</td>
                                    <td class="status">
                                        <span *ngIf="item.actif == 1" class="badge bg-success-subtle text-success text-uppercase"> Actif </span>
                                        <span *ngIf="item.actif == 0" class="badge bg-danger-subtle text-danger text-uppercase"> Inactif </span>
                                    </td>
                                    <td>
                                        <ul class="list-inline hstack gap-2 mb-0">
                                            <li class="list-inline-item" data-bs-toggle="tooltip" data-bs-trigger="hover" data-bs-placement="top" title="View">
                                                <a href="#" class="text-primary d-inline-block">
                                                    <i class="ri-eye-fill fs-16"></i>
                                                </a>
                                            </li>
                                            <li class="list-inline-item edit" data-bs-toggle="tooltip" data-bs-trigger="hover" data-bs-placement="top" title="Edit">
                                                <a href="#showModal" data-bs-toggle="modal" (click)="modalUpdate(item)" class="text-primary d-inline-block edit-item-btn">
                                                    <i class="ri-pencil-fill fs-16"></i>
                                                </a>
                                            </li>
                                            <li class="list-inline-item" data-bs-toggle="tooltip" data-bs-trigger="hover" data-bs-placement="top" title="Remove">
                                                <a class="text-danger d-inline-block remove-item-btn" (click)="modalDelete(item)" data-bs-toggle="modal" href="#deleteOrder">
                                                    <i class="ri-delete-bin-5-fill fs-16"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </td>
                                </tr>
                                }
                                
                            </tbody>
                        </table>
                        <div class="noresult" style="display: none">
                            <div class="text-center">
                                <h5 class="mt-2">Désole! Aucun resultat trouvé</h5>
                                <p class="text-muted">We've searched more than 150+ Orders We did not find any orders for you search.</p>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end">
                        <div class="pagination-wrap hstack gap-2">
                            <button [disabled]="currentPage == 1" (click)="changePage(currentPage - 1)" class="btn btn-sm btn-soft-primary pagination-prev">
                                Précédent
                            </button>
                            <ul class="pagination listjs-pagination mb-0"></ul>
                            <button [disabled]="currentPage == totalPages" (click)="changePage(currentPage + 1)" class="btn btn-sm btn-soft-primary pagination-next">
                                Suivant
                            </button>
                        </div>
                    </div>
                </div>

                <div class="modal fade" id="showModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header bg-light p-3">
                                <h5 class="modal-title" id="exampleModalLabel">{{ actionModal === "create" ? 'Création' : 'Modification'}} {{title}}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="close-modal"></button>
                            </div>
                            <form [formGroup]="caisseForm">
                                <div class="modal-body">
                                    <input type="hidden" id="id-field"/>

                                    <div class="row">
                                        <div class="col-md-3 col-sm-3">
                                            <div class="mb-3" id="modal-id">
                                                <label for="orderId" class="form-label form-label-sm">code</label>
                                                <input type="text" id="orderId" class="form-control form-control-sm {{ isValidField('codecaisse')}}" formControlName="codecaisse" placeholder="" required/>
                                            </div>
                                        </div>

                                        <div class="col-md-9 col-sm-9">
                                            <div class="mb-3" id="modal-id">
                                                <label for="orderId" class="form-label form-label-sm">libelle</label>
                                                <input type="text" id="orderId" class="input-sm form-control form-control-sm {{ isValidField('libelle')}}" formControlName="libelle" placeholder="" required/>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4 col-sm-4">
                                            <div class="mb-3" id="modal-id">
                                                <label for="orderId" class="form-label form-label-sm">devise</label>
                                                <div class="input-light input-light-sm">
                                                    <select class="form-control form-control-sm bg-light border-0" formControlName="devise"  id="choices-payment-status" required id="devise">
                                                        <option value="">devise</option>
                                                        <option value="3FC45657-E282-4667-AA3A-50121F1CEB18">XAF</option>
                                                        <option value="A4473CF8-A4E3-4CDB-92E6-A2CE1320741E">USD</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-4 col-sm-4">
                                            <div class="mb-3" id="modal-id">
                                                <label for="orderId" class="form-label form-label-sm">compte</label>
                                                <div class="input-light input-light-sm">
                                                    <select class="form-control form-control-sm bg-light border-0" formControlName="compte"  id="choices-payment-status" required id="compte">
                                                        <option value="">compte</option>
                                                        <option value="7D2836D9-961A-47F6-B64C-020DE420E7D6">5730011  Fournisseurs</option>
                                                        <option value="57E3A8E7-D9B0-457A-A6DB-C73C92C534CE">5710301  Caisse principale</option>
                                                        <option value="5EF0C14F-9AAA-4CFE-9293-30233097CBF4">5729000  Caisse Charges diverses</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-4 col-sm-4">
                                            <div class="mb-3" id="modal-id">
                                                <label for="orderId" class="form-label form-label-sm">journal</label>
                                                <div class="input-light input-light-sm">
                                                    <select class="form-control form-control-sm bg-light border-0" formControlName="journal" id="choices-payment-status" required id="journal">
                                                        <option value="">journal</option>
                                                        @for (journal of journaux; track $index) {
                                                            <option value="{{journal.idjournal}}">{{journal.codejournal}} {{journal.designation}}</option>
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    

                                    <!-- <div class="mb-3"> -->
                                        <!-- <label for="customername-field" class="form-label form-label-sm">societe</label> -->
                                        <input type="hidden" id="customername-field" value="B89B381E-691E-4BA7-979E-1AC4D5B1E018" class="form-control form-control-sm {{ isValidField('societe')}}" formControlName="societe" placeholder="societe"/>
                                        <!-- <div class="invalid-feedback">{{ msgErros }}</div> -->
                                    <!-- </div> -->

                                    <!-- <div class="mb-3"> -->
                                        <!-- <label for="customername-field" class="form-label form-label-sm">site</label> -->
                                        <input type="hidden" id="customername-field" value="197D7C37-7180-4DD1-80CC-843B9A6C5B52" class="form-control form-control-sm {{ isValidField('site')}}" formControlName="site" placeholder="site"/>
                                        <!-- <div class="invalid-feedback">{{ msgErros }}</div> -->
                                    <!-- </div> -->

                                    <div class="mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch" value="1" formControlName="actif" id="flexSwitchCheckChecked" checked>
                                            <label class="form-check-label" for="flexSwitchCheckChecked">Actif</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <div class="hstack gap-2 justify-content-end">
                                        <button type="button" class="btn btn-sm btn-light" data-bs-dismiss="modal">Fermer</button>
                                        <button type="submit" class="btn btn-sm btn-success" id="add-btn" (click)="onSubmit()">
                                            {{ actionModal === "create" ? 'enregistrer' : 'modifier'}}
                                        </button>
                                        <!-- <button type="button" class="btn btn-success" id="edit-btn">Update</button> -->
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Modal -->
                <div class="modal fade flip" id="deleteOrder" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-body p-5 text-center">
                                <div class="mt-4 text-center">
                                    <h4>{{titleMsg}}</h4>
                                    <p class="text-muted fs-15 mb-4">{{msgSup}}</p>
                                    <div class="hstack gap-2 justify-content-center remove">
                                        <button class="btn btn-sm btn-link link-success fw-medium text-decoration-none" id="deleteRecord-close" data-bs-dismiss="modal"><i class="ri-close-line me-1 align-middle"></i> annuler</button>
                                        <button class="btn btn-sm btn-danger" (click)="deleteConfirmed()" id="delete-record">Oui, supprimer</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--end modal -->
            </div>
        </div>

    </div>
    <!--end col-->
</div>
<!--end row-->